# Overview

This flow template is intended to serve as an example of how to currently create flow engines that themselves make API requests to aiWARE for running engine processing on the media specified in the flow logic. 

## Template code

1. Expand the collapsed code section
1. Copy the entire JSON in the section
1. Navigate to an existing Flow Engine Detail page or create a new Engine using the _New Engine_ creation wizard
1. Once in the Engine Detail page, click the **Create in Automate** button
1. When the Automate Studio editor loads, click on the hamburger menu and select the **Import** option
1. Paste the JSON on your clipboard into the flow and click Import
1. That's it, you now have imported this template to experiment with in your flow engine!

<details>
<summary>Expand for flow definition </summary>

```
[{"id":"5b3f707a.c5944","type":"subflow","name":"concat cognitive results","info":"","category":"","in":[{"x":40,"y":80,"wires":[{"id":"9c241f6.24ee7e"}]}],"out":[{"x":960,"y":300,"wires":[{"id":"18d0dd43.4a6b63","port":0}]},{"x":400,"y":200,"wires":[{"id":"9c241f6.24ee7e","port":1},{"id":"9c5dbb53.afe8d8","port":1},{"id":"dfb8420f.ecbd4","port":1}]}],"env":[],"color":"#FFAAAA","icon":"font-awesome/fa-bolt"},{"id":"3c39c314.5930dc","type":"function","z":"5b3f707a.c5944","name":"Process Results","func":"// Save TDO name to use as filename of Word document:\n\nmsg.filename = \"\";\nvar tdoNameArray = msg.payload.temporalDataObject.name.split(\".\");\n\nfor (var i = 0; i < tdoNameArray.length - 1; i++)\n{\n    msg.filename += tdoNameArray[i] + \".\";\n}\n\nmsg.filename += \"docx\";\n\n// Save Engine IDs for Transcription and Speaker Separation engine tasks that have completed on the TDO:\n\n// Engine ID of TDO's Transcription engine \nvar transcriptionEngineId = \"\";\n\n// Engine ID of TDO's translate engine\nvar translateEngineId = \"\";\n\nvar jobArray = msg.payload.temporalDataObject.jobs.records;\n\nfor (var i = 0; i < jobArray.length; i++)\n{\n\tvar taskArray = jobArray[i].tasks.records;\n\n\tfor (var j = 0; j < taskArray.length; j++)\n\t{\n\t\tvar curEngineId = taskArray[j].engine.id;\t\t\t\t\n\t\tvar curEngineCategoryId = taskArray[j].engine.category.id;\n\t\t\n\t\t// Use first Engine ID encountered for Transcription category\n\t\tif (curEngineCategoryId === \"67cd4dd0-2f75-445d-a6f0-2f297d6cd182\" && transcriptionEngineId === \"\")\n\t\t{\n\t\t\ttranscriptionEngineId = curEngineId;\n\t\t}\n\t\t// Use first Engine ID encountered for Translate category\n\t\telse if (curEngineCategoryId === \"3b2b2ff8-44aa-4db4-9b71-ff96c3bf5923\" && translateEngineId === \"\")\n\t\t{\n\t\t\ttranslateEngineId = curEngineId;\n\t\t}\n\t}\n}\n\nmsg.transcriptionEngineId = transcriptionEngineId;\nmsg.translateEngineId = translateEngineId;\n\nreturn msg;","outputs":1,"noerr":0,"x":420,"y":80,"wires":[["9c5dbb53.afe8d8"]]},{"id":"9c241f6.24ee7e","type":"aiware","z":"5b3f707a.c5944","name":"get EngineIDs","format":"handlebars","syntax":"mustache","template":"query {\n  temporalDataObject(id: \"{{tdoId}}\") {\n    name\n    jobs {\n      records {\n        id\n        createdDateTime\n        status\n        tasks(status: complete) {\n          records {\n            id\n            status\n            engine {\n              id\n              name\n              category {\n                id\n                name\n              }\n            }\n          }\n        }\n      }      \n    }\n  }\n}","x":200,"y":80,"wires":[["3c39c314.5930dc"],[]]},{"id":"9c5dbb53.afe8d8","type":"switch","z":"5b3f707a.c5944","name":"Translation Exists?","property":"translateEngineId","propertyType":"msg","rules":[{"t":"empty"},{"t":"nempty"}],"checkall":"true","repair":false,"outputs":2,"x":627.5555419921875,"y":80,"wires":[["dfb8420f.ecbd4"],[]]},{"id":"dfb8420f.ecbd4","type":"aiware","z":"5b3f707a.c5944","name":"Get Engine Results","format":"handlebars","syntax":"mustache","template":"query {\n\tengineResults(tdoId: \"{{tdoId}}\", engineIds: [\"{{transcriptionEngineId}}\"]) {\n\t  records {\n\t\ttdoId\n\t\tengineId\n\t\tstartOffsetMs\n\t\tstopOffsetMs\n\t\tjsondata\n\t\tassetId\n\t\tuserEdited\n\t  }\n\t}\n}","x":870,"y":80,"wires":[["18d0dd43.4a6b63"],[]]},{"id":"18d0dd43.4a6b63","type":"function","z":"5b3f707a.c5944","name":"format engine results","func":"\nvar transcriptionArray = msg.payload.engineResults.records[0].jsondata.series;  // JSON output of Transcription engine results\nvar textContent = \"\";\t                                                        // Content of \"text\" output\n\n// Go through each word in \"transcriptionArray\" and build \"textContent\"\nfor (var i = 0; i < transcriptionArray.length; i++)\n{\n\tvar curWord = transcriptionArray[i].words[0].word;\n\t\n\t// If current word is a period, append it to \"textContent\"\n\tif (curWord === \".\")\n\t{\n\t\ttextContent += curWord;\n\t}\n\t// Otherwise, append a space followed by the current word to \"textContent\"\n\telse\n\t{\n\t\ttextContent += \" \" + curWord;\n\t}\n}\n\nmsg.textContent = textContent.trim();\nnode.warn(\"msg.textContent = \" + msg.textContent);\n\nmsg.to = 'andrew+blmbgreport@veritone.com';\nmsg.cc = 'minh.nguyen+blmbgreport@setacinq.vn';\n\nmsg.topic = 'Your NLP Results (Flow Engine)';\n\nreturn msg;","outputs":1,"noerr":0,"x":760,"y":300,"wires":[[]]},{"id":"c20ef88c.0f9d88","type":"subflow","name":"error reporting","info":"","category":"","in":[],"out":[],"env":[],"color":"#FFAAAA","icon":"node-red/alert.svg"},{"id":"f469e397.cac46","type":"catch","z":"c20ef88c.0f9d88","name":"","scope":null,"uncaught":true,"x":200,"y":140,"wires":[["f369edbe.24278","3f954412.2e82dc","90c07ddc.2eb1e"]]},{"id":"f369edbe.24278","type":"debug","z":"c20ef88c.0f9d88","name":"Catch all errors","active":true,"tosidebar":true,"console":true,"tostatus":false,"complete":"payload","targetType":"msg","x":470,"y":140,"wires":[]},{"id":"2e54059b.52291a","type":"e-mail","z":"c20ef88c.0f9d88","server":"smtp.mandrillapp.com","port":"587","secure":false,"tls":false,"name":"andrew+blmbgerrs@veritone.com","dname":"email","x":650,"y":240,"wires":[]},{"id":"3f954412.2e82dc","type":"function","z":"c20ef88c.0f9d88","name":"append error objs","func":"//Structure an email subject!\nmsg.topic = `Flow Engine Runtime Error for Task - ${msg.edgeTaskId}`;\n\n//Temporary value to store the msg.payload value\nlet errPayload = msg.payload;\n\n\n//Structure a response to both Edge & Email Alert\nmsg.payload = {\n    \"Message\":\"The engine task encountered an error at runtime. See report below\",\n    \"errorBody\":msg.error,\n    \"previousPayload\":errPayload\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":470,"y":240,"wires":[["2e54059b.52291a"]]},{"id":"90c07ddc.2eb1e","type":"aiware-out","z":"c20ef88c.0f9d88","name":"","statusCode":"500","x":460,"y":60,"wires":[]},{"id":"49d53456.c8c17c","type":"subflow","name":"job report","info":"","category":"","in":[{"x":80,"y":80,"wires":[{"id":"8074b75b.3ef598"}]}],"out":[],"env":[],"color":"#C0DEED","icon":"node-red/veritone-logo-transparent.png"},{"id":"bd179963.49ad48","type":"e-mail","z":"49d53456.c8c17c","server":"smtp.mandrillapp.com","port":"587","secure":false,"tls":false,"name":"","dname":"email","x":370,"y":80,"wires":[]},{"id":"8074b75b.3ef598","type":"function","z":"49d53456.c8c17c","name":"","func":"msg.topic = 'Bloomberg Flow: Job created';\nmsg.to = 'andrew+jobreport@veritone.com';\nmsg.cc = 'minh.nguyen+jobreport@setacinq.vn';\n\nconst jobReport = msg.payload;\n\nmsg.payload = `Your job created by flow engine: ${jobReport}`\n\nreturn msg;","outputs":1,"noerr":0,"x":200,"y":80,"wires":[["bd179963.49ad48"]]},{"id":"e8111db7.09df3","type":"subflow","name":"aiWARE Poll Job (BETA)","info":"# Overview\nThis subflow encapsulates the polling pattern that accepts a `JobId` and polls the Job status\n\n## Input\n - `msg.jobId` - expects a valid Id of a Job created in your Veritone Organization\n\n## Output\n 1. The top port outputs the `msg.payload` and stores the results of the job query in JSON format\n 2. The bottom port outputs *failed* or *aborted* jobs in the `msg.payload` property\n\n## Beta Tag\n - Does *not* gracefully handle errors\n - Does *not* handle edge cases very well\n","category":"","in":[{"x":86.65465545654297,"y":286.2382164001465,"wires":[{"id":"6e023b2.85155c4"}]}],"out":[{"x":844.5081176757812,"y":494.53173828125,"wires":[{"id":"606a1259.1bbd6c","port":2}]},{"x":841.7302913665771,"y":588.9761734008789,"wires":[{"id":"606a1259.1bbd6c","port":4},{"id":"606a1259.1bbd6c","port":5}]}],"env":[],"color":"#FFAAAA","icon":"node-red/veritone-logo-transparent.png"},{"id":"606a1259.1bbd6c","type":"switch","z":"e8111db7.09df3","name":"check task status","property":"jobStatus","propertyType":"msg","rules":[{"t":"eq","v":"queued","vt":"str"},{"t":"eq","v":"running","vt":"str"},{"t":"eq","v":"complete","vt":"str"},{"t":"eq","v":"pending","vt":"str"},{"t":"eq","v":"failed","vt":"str"},{"t":"eq","v":"aborted","vt":"str"}],"checkall":"true","repair":false,"outputs":6,"x":450,"y":480,"wires":[["ab388984.585d58"],["ab388984.585d58"],[],["ab388984.585d58"],[],[]]},{"id":"ab388984.585d58","type":"delay","z":"e8111db7.09df3","name":"Keep Polling 25s...","pauseType":"delay","timeout":"25","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":852.1390075683594,"y":394.976318359375,"wires":[["1ca061b0.c89f7e"]]},{"id":"1ca061b0.c89f7e","type":"aiware","z":"e8111db7.09df3","name":"CheckJobStatus","format":"handlebars","syntax":"mustache","template":"query checkJobStatus{\n    job(id:\"{{jobId}}\" ) {\n    id\n    status\n    targetId\n    tasks {\n        records{\n            id\n            status\n            jobId\n            output\n            engine{\n                id\n                name\n                categoryId\n                }\n                target{\n                id\n                organization{\n                    id\n                    name\n                    }\n                }\n            }\n        }\n    }\n}","x":510,"y":280,"wires":[["ce3b92f3.78069"],[]]},{"id":"ce3b92f3.78069","type":"change","z":"e8111db7.09df3","name":"get task details","rules":[{"p":"jobStatus","t":"set","pt":"msg","to":"payload.job.status","tot":"msg"},{"p":"jobId","t":"set","pt":"msg","to":"payload.job.id","tot":"msg"},{"p":"tdoId","t":"set","pt":"msg","to":"payload.job.targetId","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":406.2858581542969,"y":373.85693359375,"wires":[["606a1259.1bbd6c"]]},{"id":"6e023b2.85155c4","type":"change","z":"e8111db7.09df3","name":"set jobId","rules":[{"p":"jobId","t":"set","pt":"msg","to":"payload.createJob.id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":240,"y":280,"wires":[["1ca061b0.c89f7e"]]},{"id":"95365ac.08b9aa8","type":"tab","label":"Flow NLP Demo 1","disabled":false,"info":"# Overview\nFlow engine processing a file with Transcription and then translation\n\n## Use case\nIn this use-case, we:\n - Ingest an audio visual file from an S3 bucket\n - Write some initial metadata to the file (\"name\") and run `Transcription` processing\n - Once transcription is done, we then:\n  - run Face Recognition (detecting and recognizing) using a Library of Faces\n  - run Speaker Separation which processes the file *and* the transcript\n - Once all engine processes have finished, we then query the cognitive results,\n - We merge them all together\n - And then send out as an HTML email template to the specified recipient!"},{"id":"4710fd05.5a5c14","type":"subflow:e8111db7.09df3","z":"95365ac.08b9aa8","name":"","env":[],"x":930,"y":360,"wires":[["99782c6a.8d723"],["23c6a57c.802d7a"]]},{"id":"5548d536.ad2a4c","type":"comment","z":"95365ac.08b9aa8","name":"process existing tdo","info":"","x":650,"y":300,"wires":[]},{"id":"41e941a.81ff0c","type":"debug","z":"95365ac.08b9aa8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":1510,"y":280,"wires":[]},{"id":"e73ddc8e.d060e","type":"inject","z":"95365ac.08b9aa8","name":"testing","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1230,"y":200,"wires":[["71129f55.a9342"]]},{"id":"71129f55.a9342","type":"change","z":"95365ac.08b9aa8","name":"set test TDO","rules":[{"p":"tdoId","t":"set","pt":"msg","to":"961904215","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1210,"y":280,"wires":[["99782c6a.8d723"]]},{"id":"f5417735.7adf18","type":"aiware","z":"95365ac.08b9aa8","name":"transcribe","format":"handlebars","syntax":"mustache","template":"mutation createJob{\n  createJob(input:{\n    isReprocessJob:true\n    targetId:\"{{tdoId}}\" #merge in payload value w/ mustache syntax\n    tasks: [\n       {\n        engineId: \"54525249-da68-4dbf-b6fe-aea9a1aefd4d\"\n        #transcription\n       }]\n  }) {\n    id\n  }\n}","x":680,"y":360,"wires":[["da96f0cc.c398e","cba1967d.9f4918","4710fd05.5a5c14"],["23c6a57c.802d7a"]]},{"id":"4ce5a841.672ff8","type":"aiware-in","z":"95365ac.08b9aa8","name":"","tdoId":"1010801274","tdoContent":"","addToJob":false,"endpointUUID":"","x":120,"y":340,"wires":[["64223232.ab95dc"]]},{"id":"da96f0cc.c398e","type":"debug","z":"95365ac.08b9aa8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":910,"y":200,"wires":[]},{"id":"4e864bc1.d2afa4","type":"template","z":"95365ac.08b9aa8","name":"format html","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<!DOCTYPE html PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\"\n   \"http://www.w3.org/TR/html4/loose.dtd\">\n<html>\n<head>\n    <meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\">\n    <meta name=\"viewport\" content=\"initial-scale=1.0\">\n    <meta name=\"format-detection\" content=\"telephone=no\">\n    <title>aiWARE analytics report</title>\n    <style type=\"text/css\" data-premailer=\"ignore\">\n        .ReadMsgBody { width: 100%; background-color: #f4f4f4;}\n        .ExternalClass {width: 100%; background-color: #f4f4f4;}\n        .ExternalClass, .ExternalClass p, .ExternalClass span, .ExternalClass font, .ExternalClass td, .ExternalClass div {line-height:100%;}\n        body {-webkit-text-size-adjust:none; -ms-text-size-adjust:none;}\n        body {margin:0; padding:0;}\n        table {border-spacing:0;}\n        table td {border-collapse:collapse;}\n        .yshortcuts a {border-bottom: none !important;}\n        @media screen and (max-width: 600px), screen and (max-device-width: 600px) {\n            table[class=\"container\"] { width: 95% !important; }\n        }\n        @media screen and (max-width: 480px), screen and (max-device-width: 480px) {\n            td[class=\"container-padding\"] { padding-left: 12px !important; padding-right: 12px !important; }\n          \ttable.container td.logo { text-align: center; border-bottom: 1px solid #efefef; height:100px; color:#fff }\n        }\n    </style>\n    <style type=\"text/css\">\n        body { background-color: #f4f4f4; padding: 10px 0; margin: 10px 0; }\n        table.container { font-family: Lato, Arial, sans-serif; color: #434343; }\n        table.container td.header div { height: 10px; border: 1px solid #042f6d; }\n        table.container td.logo { background-size: cover; text-align: center; border-bottom: 1px solid #efefef; height:200px; color:#fff }\n        h1, h2, h3, h4, h5, h6 { color: #4e7ca4; line-height: 1.5; margin: 0 0 25px 0; }\n        h1 { font-size: 24px; } h2 { font-size: 18px; } h3 { font-size: 16px; } h4, h5, h6 { font-size: 14px; }\n        p { font-size: 14px; line-height: 1.5; margin: 0 0 25px 0; color: #434343; }\n        a { color: #0e4595; text-decoration: underline; }\n        td.container-padding img { border: 1px solid #ddd; padding: 37px; margin: 0 19px; }\n        a.intercom-h2b-button { background-color: #3e8acc; border-radius: 3px; color:#fff; display: inline-block; font-size: 14px; height: 44px; line-height:44px; padding: 0px 28px; text-decoration: none; }\n        ul li, ol li { font-size: 14px; line-height: 1.5; }\n        table.footer { background: #f4f4f4; width: 100%; padding-top:30px;}\n        table.footer td { vertical-align: middle; text-align: center; color: #434343; font-size: 12px; }\n      \ttable.footer p { color: #a0a0a0; font-size:12px; }\n    </style>\n</head>\n<body style=\"margin: 10px 0;padding: 10px 0;-webkit-text-size-adjust: none;-ms-text-size-adjust: none;background-color: #f4f4f4;\" leftmargin=\"0\" topmargin=\"0\" marginwidth=\"0\" marginheight=\"0\">\n<br>\n<table border=\"0\" width=\"100%\" height=\"100%\" cellpadding=\"0\" cellspacing=\"0\" bgcolor=\"#f4f4f4\" style=\"border-spacing: 0;\">\n  <tr>\n    <td align=\"center\" valign=\"top\" bgcolor=\"#f4f4f4\" style=\"background-color: #f4f4f4;border-collapse: collapse;\">\n      <table width=\"600\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\" class=\"container\" bgcolor=\"#ffffff\" style=\"border-spacing: 0;font-family: Lato, Arial, sans-serif;color: #434343;\">\n        <tr>\n          <td class=\"container-padding\" bgcolor=\"#ffffff\" style=\"background-color: #ffffff;padding-left: 30px;padding-right: 30px;border-collapse: collapse;\"><br />\n            <!-- ### Begin Content! ### -->\n            <h1>Your aiWARE Analytics Report</h1>\n\n            <!-- ADD CONTENT HERE -->        \n            <p style=\"font-size: 14px; line-height: 1.5; margin: 0 0 25px 0; color: #434343;\">\n            <p>Hi {{firstName}}, here is your latest aiWARE cognitive analytics report:\n            </td>\n        </tr>\n        <tr>\n        <td valign=\"middle\" style=\"padding:10px 40px 5px; background-color:#ffffff; font-family:'Lato',Arial,sans-serif; font-size:14px;\"><table width=\"100%\">\n          <tbody>\n            <tr>\n              <td><img src=\"https://static.veritone.com/email/gear-fa.png\" width=\"18px\" style=\"height:10%;\"></td>\n              <td class=\"container-padding\" width=\"100%\" style=\"padding-left:5px;\"><span style=\"font-family:'Lato-Bold',Arial,sans-serif; font-weight:bold;\">Your Transcription Results</span>\n              </td>\n            </tr>\n          </tbody>\n        </table>\n        </td>\n        </tr>\n        <tr>\n        <td style=\"padding:5px 40px 25px 40px; background-color:#ffffff; font-family:'Lato',Arial,sans-serif; font-size:14px;\"><table width=\"100%\">\n          <tbody>\n            <tr>\n              <td style=\"padding-bottom: 5px;\">\n                <tbody>\n                  <tr>\n                    <td style=\"padding:5px 20px 5px 10px; background-color:#ffffff; font-family:'Lato',Arial,sans-serif; font-size:14px; color:#333333;\">\n                      <p style=\"margin:0px 10px 0px 20px; background-color:#ffffff; font-family:'Lato',Arial,sans-serif; font-size:14px; color#333333;\">\n                          {{{textContent}}}\n                      </p> \n                    </td>\n                  </tr>\n                </tbody>  \n              </td>\n            </tr>\n            </tbody>\n            </table></td>\n        </tr>\n        <tr>  \n        <td valign=\"middle\" style=\"padding:0px 40px; background-color:#ffffff; font-family:'Lato',Arial,sans-serif; font-size:14px;\"><table width=\"100%\">\n          <tbody>\n            <tr>\n              <td><img src=\"https://static.veritone.com/email/info-negfill.png\" width=\"18px\" style=\"height:10%;\"></td>\n              <td class=\"container-padding\" width=\"100%\" style=\"padding-left:5px;\"><span style=\"font-family:'Lato-Bold',Arial,sans-serif; font-weight:bold;\">Details</span></td>\n            </tr>\n          </tbody>\n        </table>\n        </td>\n        </tr>\n        <tr>\n        <td style=\"padding:5px 40px 25px 40px; background-color:#ffffff; font-family:'Lato',Arial,sans-serif; font-size:14px;\"><table width=\"100%\">\n            <tbody>\n              <tr>\n                <td style=\"padding: 0px 10px 0px 25px;\"><span style=\"font-family:'Lato',Arial,sans-serif;\">\n                  You can view the original file and other cognitive details for this media file by clicking the button below\n                  </td>\n                </tr>\n              </tbody>\n            </table>\n          </td>\n        </tr>\n        <tr>\n            <td class=\"container-padding\" style=\"background-color: #ffffff; padding: 10px 40px;\">\n                <center><a href=\"https://cms.veritone.com/#/media-details/{{todId}}\" style=\"background-color: #3e8acc; border-radius: 3px; color:#fff; display: inline-block; font-size: 14px; width:133px; height:44px; line-height:44px; padding: 0px 28px; text-align:center; font-family:'Lato',Arial,sans-serif; text-decoration: none;\">Media Link</a></center>\n            </td>\n        </tr>    \n        <tr>\n        <td class=\"container-padding\" bgcolor=\"#ffffff\" style=\"background-color: #ffffff;padding-left: 30px;padding-right: 30px;border-collapse: collapse;\">\n            <p style=\"font-size: 14px; line-height: 1.5; margin: 0 0 25px 0; color: #434343;\">\n            Create with care,<br>\n            Team Veritone\n            </p>\n          </td>\n        </tr>\n            <!-- ### End Content ### -->\n\n        <tr>\n            <td style=\"border-collapse: collapse;\">\n                <table border=\"0\" width=\"100%\" height=\"100%\" cellpadding=\"0\" cellspacing=\"0\" bgcolor=\"#fbfbfb\" class=\"footer\" style=\"border-spacing: 0;background: #f4f4f4;width: 100%;padding-top: 30px;\">\n                    <tr>\n                      <td style=\"border-collapse: collapse;vertical-align: middle;text-align: center;color: #434343;font-size: 12px;\">\n                        <p style=\"font-size: 12px;line-height: 1.5;margin: 0 0 25px 0;color: #a0a0a0;\">&copy; 2020 Veritone | All Rights Reserved<br>\n                        575 Anton Blvd, Costa Mesa, CA 92627\n                        </p>\n                      </td>\n                    </tr>\n                </table>\n            </td>\n        </tr>\n      </table>\n    </td>\n  </tr>\n</table>\n<br>\n</body>\n</html>","output":"str","x":1510,"y":360,"wires":[["a4010c87.172f1"]]},{"id":"a4010c87.172f1","type":"e-mail","z":"95365ac.08b9aa8","server":"smtp.mandrillapp.com","port":"587","secure":false,"tls":false,"name":"","dname":"email","x":1670,"y":360,"wires":[]},{"id":"3ed4b487.e9786c","type":"inject","z":"95365ac.08b9aa8","name":"mock aiware chunk","topic":"","payload":"{\"chunkMimeType\":\"\",\"chunkUUID\":\"15888989_1588898904465178551_http.in\",\"chunkIndex\":\"15888989_1588898904465178551_http.in\",\"startOffsetMS\":\"0\",\"endOffsetMS\":\"0\",\"width\":\"0\",\"height\":\"0\",\"libraryId\":\"\",\"libraryEngineModelId\":\"\",\"cacheURI\":\"http://localhost:32803/cache/chunk/6/832864aa-4921-4ff7-b30b-44ecc36782d2/34236a49-83ee-4213-b233-20adb013f4c8/3bc14a63-6ee3-47ee-930e-9542af78c728/input/1fbc19b0-3321-4a47-b3e0-8b9dffc3124c/15888989_1588898904465178551_http.in\",\"veritoneApiBaseUrl\":\"https://api.veritone.com\",\"token\":\"v3-edge-controller:205893ed930198a51453642047c2984139a3843275710173186b77449767\",\"internalJobId\":\"34236a49-83ee-4213-b233-20adb013f4c8\",\"internalTaskId\":\"3bc14a63-6ee3-47ee-930e-9542af78c728\",\"taskTmpDir\":\"/cache/6/832864aa-4921-4ff7-b30b-44ecc36782d2/job/342/34236a49-83ee-4213-b233-20adb013f4c8/task/3bc14a63-6ee3-47ee-930e-9542af78c728/tmp\",\"engineDir\":\"/cache/27328378-33f6-41f4-b7d8-b889d26eead9\",\"payload\":{\"jobId\":\"\",\"nfsShard\":\"6\",\"recordingId\":\"0\",\"taskId\":\"\",\"taskPayload\":{\"nfsShard\":\"6\"},\"token\":\"v3-edge-controller:205893ed930198a51453642047c2984139a3843275710173186b77449767\",\"veritoneApiBaseUrl\":\"https://api.veritone.com\"},\"heartbeatWebhook\":\"http://localhost:33239/heartbeat/3bc14a63-6ee3-47ee-930e-9542af78c728?chunkId=15888989_1588898904465178551_http.in\",\"resultWebhook\":\"http://localhost:33239/result/3bc14a63-6ee3-47ee-930e-9542af78c728?chunkId=15888989_1588898904465178551_http.in\",\"chunkContext\":\"15888989_1588898904465178551_http.in\",\"maxTTL\":\"7200\",\"chunk-metadata-x-forwarded-proto\":\"http\",\"chunk-metadata-content-type\":\"application/json\",\"chunk-metadata-cookie\":\"AWSALB=p+iXt4Y+HMX7+0C3XRE+14To6f7TmzvH8AEmGM14IVaz6R7Uajb50SMdE+oyf0FuW2R7y00OaoqdycEbLl+9DfJL6h55NujqFTYRV8A4YkWJZSe60ZjCqNzGpfMv; AWSALBCORS=p+iXt4Y+HMX7+0C3XRE+14To6f7TmzvH8AEmGM14IVaz6R7Uajb50SMdE+oyf0FuW2R7y00OaoqdycEbLl+9DfJL6h55NujqFTYRV8A4YkWJZSe60ZjCqNzGpfMv\",\"chunk-metadata-postman-token\":\"8d4f97aa-fc5b-4119-bde7-900c62cb5a41\",\"chunk-metadata-remoteaddr\":\"10.216.103.203:39734\",\"chunk-metadata-cache-control\":\"no-cache\",\"chunk-metadata-user-agent\":\"PostmanRuntime/7.24.1\",\"chunk-metadata-x-amzn-trace-id\":\"Root=1-5eb4ac58-fe72e020faccb158c8ff5538\",\"chunk-metadata-x-forwarded-port\":\"80\",\"chunk-metadata-x-forwarded-for\":\"10.111.0.93\",\"chunk-metadata-content-length\":\"38\",\"chunk-metadata-accept-encoding\":\"gzip, deflate, br\",\"chunk-metadata-accept\":\"*/*\",\"chunk-metadata-authorization\":\"Bearer 37083df3-8a2a-4576-b14c-e20930e41bad\",\"aiwareChunk\":{\"type\":\"Buffer\",\"data\":[123,32,34,101,100,103,101,80,97,121,108,111,97,100,34,58,10,32,32,123,10,32,32,34,116,100,111,73,100,34,58,34,57,54,49,57,48,52,50,49,53,34,44,10,32,32,34,115,101,110,100,84,111,34,58,34,97,110,100,114,101,119,43,98,108,109,98,103,105,110,106,101,99,116,64,118,101,114,105,116,111,110,101,46,99,111,109,34,44,10,32,32,34,102,105,114,115,116,78,97,109,101,34,58,34,65,110,100,121,34,10,32,32,125,10,125]}}","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":130,"y":440,"wires":[["64223232.ab95dc"]]},{"id":"64223232.ab95dc","type":"function","z":"95365ac.08b9aa8","name":"Parse chunk buffer","func":"//hardcode the API url for this run\nmsg.url = 'https://api.veritone.com/v3/graphql';\n\n//Hardcoded token so the engine processing works at runtime\nmsg.orgToken = '<your org token here>';\n\n//Parse the string into a JSON\n//We should evaluate if this is actually a JSOn\nconst obj = JSON.parse(Buffer.from(msg.payload.aiwareChunk));\nconst {edgePayload} = obj;\n\n//Now we can start parsing the actual JSON message :-D\n//Check for tdoId value\nif(edgePayload.tdoId){\n    msg.tdoId = edgePayload.tdoId\n}\n//Now check for sendTo value\nmsg.to = edgePayload.sendTo || \"andrew+noSendTo@veritone.com\";\nmsg.firstName = edgePayload.firstName || 'AndyThere';\n//Create an event msg that saves `aiware in` payload\nmsg.event = msg.payload;\nmsg.payload.aiwareChunkObject = obj;\nreturn msg;","outputs":1,"noerr":0,"x":370,"y":440,"wires":[["f5417735.7adf18","1d82e48d.f26b0b"]]},{"id":"59fba8f3.f69258","type":"delay","z":"95365ac.08b9aa8","name":"","pauseType":"delay","timeout":"3","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1520,"y":440,"wires":[["787edb70.c0efb4"]]},{"id":"787edb70.c0efb4","type":"aiware-out","z":"95365ac.08b9aa8","name":"Edge OK","statusCode":200,"x":1760,"y":440,"wires":[]},{"id":"57945901.b62428","type":"inject","z":"95365ac.08b9aa8","name":"","topic":"","payload":"{\"chunkMimeType\":\"\",\"chunkUUID\":\"15894439_1589443927388704942_http.in\",\"chunkIndex\":\"15894439_1589443927388704942_http.in\",\"startOffsetMS\":\"0\",\"endOffsetMS\":\"0\",\"width\":\"0\",\"height\":\"0\",\"libraryId\":\"\",\"libraryEngineModelId\":\"\",\"cacheURI\":\"http://localhost:45893/cache/chunk/5/832864aa-4921-4ff7-b30b-44ecc36782d2/e844a8c6-0fc1-469f-a49f-803b1fabe473/0e9ac7bd-3c77-4e49-ba78-855db0a6fd3d/input/dbb9dd8b-03bd-4fed-8f22-7015a1c5ba46/15894439_1589443927388704942_http.in\",\"veritoneApiBaseUrl\":\"https://api.veritone.com\",\"token\":\"v3-edge-controller:205893ed930198a51453642047c2984139a3843275710173186b77449767\",\"internalJobId\":\"e844a8c6-0fc1-469f-a49f-803b1fabe473\",\"internalTaskId\":\"0e9ac7bd-3c77-4e49-ba78-855db0a6fd3d\",\"taskTmpDir\":\"/cache/5/832864aa-4921-4ff7-b30b-44ecc36782d2/job/e84/e844a8c6-0fc1-469f-a49f-803b1fabe473/task/0e9ac7bd-3c77-4e49-ba78-855db0a6fd3d/tmp\",\"engineDir\":\"/cache/75149bba-e825-41a8-96dd-b671d6071686\",\"payload\":{\"jobId\":\"\",\"nfsShard\":\"5\",\"recordingId\":\"0\",\"taskId\":\"\",\"taskPayload\":{\"nfsShard\":\"5\"},\"token\":\"v3-edge-controller:205893ed930198a51453642047c2984139a3843275710173186b77449767\",\"veritoneApiBaseUrl\":\"https://api.veritone.com\"},\"heartbeatWebhook\":\"http://localhost:39055/heartbeat/0e9ac7bd-3c77-4e49-ba78-855db0a6fd3d?chunkId=15894439_1589443927388704942_http.in\",\"resultWebhook\":\"http://localhost:39055/result/0e9ac7bd-3c77-4e49-ba78-855db0a6fd3d?chunkId=15894439_1589443927388704942_http.in\",\"chunkContext\":\"15894439_1589443927388704942_http.in\",\"maxTTL\":\"7200\",\"chunk-metadata-postman-token\":\"47cd4338-c6c4-4e2d-8a01-fa33e474a84c\",\"chunk-metadata-authorization\":\"Bearer 37083df3-8a2a-4576-b14c-e20930e41bad\",\"chunk-metadata-cookie\":\"AWSALB=38g3F0VpVdvcXkpi0uHt7QMUmqwkixUxw7ALbPyFwlkrBYBfYbGBIX2SfQjVJWtI7Kjj84J6dLVvir9DkcKVDchD+aL/S4fgOz7p9Wr/pLiSY4JWJwkwnUZwgUa1; AWSALBCORS=38g3F0VpVdvcXkpi0uHt7QMUmqwkixUxw7ALbPyFwlkrBYBfYbGBIX2SfQjVJWtI7Kjj84J6dLVvir9DkcKVDchD+aL/S4fgOz7p9Wr/pLiSY4JWJwkwnUZwgUa1\",\"chunk-metadata-accept-encoding\":\"gzip, deflate, br\",\"chunk-metadata-x-amzn-trace-id\":\"Root=1-5ebcfd57-4695009b562969f387be142f\",\"chunk-metadata-user-agent\":\"PostmanRuntime/7.24.1\",\"chunk-metadata-x-forwarded-proto\":\"http\",\"chunk-metadata-remoteaddr\":\"10.216.2.222:18066\",\"chunk-metadata-x-forwarded-for\":\"10.111.0.93\",\"chunk-metadata-cache-control\":\"no-cache\",\"chunk-metadata-content-type\":\"application/json\",\"chunk-metadata-accept\":\"*/*\",\"chunk-metadata-content-length\":\"70\",\"chunk-metadata-x-forwarded-port\":\"80\",\"chunkTest\":{\"type\":\"Buffer\",\"data\":[123,10,32,32,32,32,34,114,101,99,111,114,100,105,110,103,67,114,101,97,116,101,100,34,58,32,123,10,32,32,32,32,32,32,32,32,34,114,101,99,111,114,100,105,110,103,73,100,34,58,32,34,57,54,49,57,48,52,50,49,53,34,10,32,32,32,32,125,10,125]}}","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":110,"y":540,"wires":[["64223232.ab95dc"]]},{"id":"cba1967d.9f4918","type":"subflow:49d53456.c8c17c","z":"95365ac.08b9aa8","name":"","env":[],"x":920,"y":280,"wires":[]},{"id":"c2035d02.aa3f5","type":"subflow:c20ef88c.0f9d88","z":"95365ac.08b9aa8","name":"","env":[],"x":630,"y":100,"wires":[]},{"id":"99782c6a.8d723","type":"subflow:5b3f707a.c5944","z":"95365ac.08b9aa8","name":"","env":[],"x":1230,"y":360,"wires":[["4e864bc1.d2afa4","41e941a.81ff0c","59fba8f3.f69258"],["23c6a57c.802d7a"]]},{"id":"23c6a57c.802d7a","type":"aiware-out","z":"95365ac.08b9aa8","name":"","statusCode":"500","x":1300,"y":540,"wires":[]},{"id":"1d82e48d.f26b0b","type":"debug","z":"95365ac.08b9aa8","name":"","active":true,"tosidebar":true,"console":true,"tostatus":false,"complete":"payload","targetType":"msg","x":680,"y":580,"wires":[]}]
```

</details>


## Implementation notes

- Earlier versions are using a `msg.orgToken` variable to ensure that the flow engine has access to the createJob mutation to run the engine.
- This is **not** recommended especially for making your flows available across multiple orgs
- Instead, the `jwtRights` field will be automatically written with the rights designated for your flow engine


## Recommended Reading

Our mission with Automate Studio is to create an intuitive process for processing media. We are building towards this mission and know we have a lot to learn along the way!

In the meantime, here are some recommended aiWARE Docs to familiarize yourself with the deeper points of aiWARE, running engines, and processing:

- [Overview of Veritone GraphQL API](https://docs.veritone.com/#/apis/using-graphql)
- [Engine Job Quickstart Guide](https://docs.veritone.com/#/apis/job-quickstart/)
- [More Reading on Jobs, Tasks, and TDOs](https://docs.veritone.com/#/apis/jobs-tasks-tdos)
- [Creating and Processing a Temporal Data Object (TDO)](https://docs.veritone.com/#/apis/tutorials/upload-and-process)
- [Working with the Edge REST API](https://docs.veritone.com/#/apis/edge/index.html)
